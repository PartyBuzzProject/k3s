- name: Create a namespace named 'cert-manager'
  k8s:
    kubeconfig: /etc/rancher/k3s/k3s.yaml
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: cert-manager

- name: Apply cert-manager CRDs
  command:
    cmd: kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.12.2/cert-manager.crds.yaml

- name: Copy values file to remote host
  copy:
    src: ../templates/cert-manager-values.yaml
    dest: ~/values.yaml

- name: Install cert-manager via Helm
  command:
    cmd: helm install my-cert-manager cert-manager/cert-manager --namespace cert-manager --values=values.yaml --version {{ cert-manager_version }}
  register: helm_output

- name: Output Helm command result
  debug:
    var: helm_output.stdout_lines
